@using SIGESDOC.Web.Seguridad

@model SIGESDOC.Web.Models.HojaTramiteViewModel

@{
    ViewBag.Title = "Nueva HT";
}

<div class="bottom hidden"></div>
<div id="mensajes"></div>

<ol class="breadcrumb" style="margin-bottom: 5px;">
    <li><a href="#">Hoja de Tramite</a></li>
    <li class="active">Nuevo</li>
</ol>

<div class="bs-callout bs-callout-info">
    <h4>Registro de Nueva Hoja de Tramite </h4>
    <p>Use el siguiente formulario para generar una nueva hoja de trámite</p>
</div>


<div class="modal fade" id="mdlhoja_tramite" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Buscar Hoja de Trámite</h4>
            </div>
            <form method="post" id="formhojatramite">
                <div class="modal-body">
                    <div class="form-horizontal">
                        <div>
                            @Html.Label("Buscar:")
                            @Html.TextBox("txt_Buscar_Padre", null, new { @onkeypress = "return valida_enter(this.value);" })
                            <button type="button" class="btn btn-default btn-sm buscar_ht_padre">Buscar</button>
                            <label id="lbl_carga_data_ht">  </label>
                        </div>

                        <br />

                        <div id="bus_tbl_ht">
                            <table id="tbl_ht" class="table table-striped table-hover table-condensed tabla small">
                                <thead>
                                    <tr class="cabecera text-center">
                                        <th scope="col" >HT</th>
                                        <th scope="col" >ASUNTO</th>
                                        <th scope="col" >FECHA DE EMISION</th>
                                        <th scope="col" >ACCIONES</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Mensaje</h4>
            </div>
            <div class="modal-body">
                <p>No existen registros en el destino.</p>
                <p>Por favor ingrese por lo menos un destino para guardar.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="mdlConfirmar_pagina" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Alerta</h4>
            </div>
            <div class="modal-body">
                <div id="menssage">
                    <span id="conformidad"></span>
                    <label id="lbl_valida_confirma_pagina">  </label>
                    <input type="text" id="pagina_direccion" class="hidden" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-sm" id="bntConfirmar_pagina">Si</button>
                <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>

@using (Html.BeginForm("Nuevo_Externo", "HojaTramite", FormMethod.Post, new { @id = "nuevoForm", @enctype = "multipart/form-data" }))
{

    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <ol class="breadcrumb" style="margin-bottom:0px;">
            <li class="active">Información de la Hoja de Trámite</li>
        </ol>

        <div class="row hidden">
            @Html.TextBox("var_guardar", (string)ViewBag.cond_grabar)
            @Html.TextBox("ac_externo", (string)ViewBag.vst_check_externo)
            @Html.TextBox("log_user", (string)User.Identity.Name.ToString())
            @Html.TextBox("id_oficina_crea", (string)ViewBag.id_oficina_crea)
            @Html.TextBox("ver_num_doc", (string)ViewBag.ver_numero_doc)
            @Html.TextBox("id_oficina_externa")
            @Html.TextBox("id_tipo_per")
            @Html.TextBox("persona_externa_encontro")
        </div>
        <div class="row">
            <div class="col-md-12" style="padding-top:0px;">
                <div class="form-group" style="margin-left: 0px; margin-right: 0px; margin-bottom: 0px;">
                    <label class=" control-label">Tupa:</label>
                    @Html.DropDownList("cmbtupa", (IEnumerable<SelectListItem>)ViewBag.lst_tupa, new { @class = "form-control input-sm" })
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4" style="padding-top:0px;">
                <div class="form-group" style="margin-left: 0px; margin-right: 0px; margin-bottom: 0px;">
                    <label class=" control-label">Tipo Documento:</label>
                    @Html.DropDownList("cmbtipo_documento", (IEnumerable<SelectListItem>)ViewBag.lst_tipo_documento, new { @class = "form-control input-sm" })
                </div>
            </div>
            <div class="col-md-2 autonume">
                <div class="form-group" style="margin-left:0px; margin-right:0px;">
                    <label class="control-label">Número:</label>
                    @Html.ValidationMessageFor(m => m.numero_documento)
                    @Html.TextBoxFor(m => m.numero_documento, new { @class = "form-control input-sm", @onpaste = "return false;", @maxlength = "10", @onkeypress = "return IsNumeric(this.value);", @placeholder = "Num" })
                </div>
            </div>
            <div class="col-md-3 autonume" style="padding-top:8px;">
                <div class="form-group" style="margin-left: 0px; margin-right: 0px; margin-bottom: 0px;">
                    <label class="control-label"></label>
                    @Html.ValidationMessageFor(m => m.nom_doc)
                    <label id="lbl_valida_nom_doc" style="color: #B44D4D">  </label>
                    @Html.TextBoxFor(m => m.nom_doc, new { @class = "form-control input-sm", @onpaste = "return false;", @maxlength = "250", @placeholder = "Ejm: -2017-ENTIDAD/...." })
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group" style="margin-left: 0px; margin-right: 0px; margin-bottom: 0px;">
                    <label class="control-label">folios:</label>
                    @Html.ValidationMessageFor(m => m.folios)
                    <label id="lbl_valida_folios" style="color: #B44D4D">  </label>
                    @Html.TextBoxFor(m => m.folios, new { @class = "form-control input-sm", @onpaste = "return false;", @maxlength = "10", @onkeypress = "return IsNumeric(this.value);" })
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <div class="form-group" style="margin-left:0px; margin-right:0px;">
                    <label class="control-label">SIGA:</label>
                    <label id="lbl_valida_pedido_siga" style="color: #B44D4D"></label>
                    @Html.DropDownList("cmb_tip_pedido_siga", (IEnumerable<SelectListItem>)ViewBag.lst_tipo_pedido_siga, new { @class = "form-control input-sm" })
                </div>
            </div>
            <div class="col-md-2" style="padding-top:8px;">
                <div class="form-group" style="margin-left: 0px; margin-right: 0px; margin-bottom: 0px;">
                    <label class="control-label"></label>
                    @Html.DropDownList("cmb_tip_anno_siga", (IEnumerable<SelectListItem>)ViewBag.lst_anno_siga, new { @class = "form-control input-sm" })
                </div>
            </div>
            <div class="col-md-2" style="padding-top:8px;">
                <div class="form-group" style="margin-left: 0px; margin-right: 0px; margin-bottom: 0px;">
                    <label class="control-label"></label>
                    @Html.TextBox("txt_pedido_siga", null, new { @class = "form-control input-sm", @onpaste = "return false;", @maxlength = "5", @onkeypress = "return IsNumeric(this.value);", @placeholder = "Num" })
                </div>
            </div>
            <div class="col-md-2" style="margin-bottom:8px;">
                <div class="form-group" style="margin-left: 0px; margin-right: 0px; margin-bottom: 0px;">
                    <label class="control-label">Relación:</label>
                    @Html.TextBoxFor(m => m.HT_PADRE, new { @class = "form-control input-sm", @readonly = "readonly" })
                </div>
            </div>
            <div class="col-md-2" style="padding-top:30px;">
                <div class="form-group" style="margin-left: 0px; margin-right: 0px; margin-bottom: 0px;">
                    <label class="control-label"></label>
                    <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#mdlhoja_tramite"><span class="glyphicon glyphicon-search"></span></button>
                    <button type="button" class="btn btn-default btn-sm limpiar"><span class="glyphicon glyphicon-trash"></span></button>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="n_act_oficina col-md-3">
                <div class="form-group" style="margin-left:0px; margin-right:0px;">
                    <label class=" control-label">De:</label>
                    @Html.DropDownList("cmbpersona_crea", (IEnumerable<SelectListItem>)ViewBag.lst_persona_crea, new { @class = "form-control input-sm" })
                </div>
            </div>
            <div class="act_oficina col-md-2">
                <div class="form-group" style="margin-left:0px; margin-right:0px;">
                    <label class=" control-label">Externo:</label>
                    @Html.DropDownList("cmb_tip_doc_iden", (IEnumerable<SelectListItem>)ViewBag.lst_tipo_documento_iden, new { @class = "form-control input-sm" })
                </div>
            </div>
            <div class="act_oficina col-md-2">
                <div class="form-group" style="margin-left:0px; margin-right:0px;">
                    <label class=" control-label">Doc.:</label>
                    <label id="lbl_valida_ext" style="color: #B44D4D">  </label>
                    @Html.TextBox("num_documento_externo", null, new { @class = " form-control input-sm", @maxlength = "20", @onkeypress = "return IsNumeric_vista(this.value);", @onkeyup = "return Valida_back_vista(this.value);" })
                </div>
            </div>
            <div class="act_oficina col-md-3">
                <div class="form-group" style="margin-left:0px; margin-right:0px;">
                    <label class=" control-label">Nombre:</label>
                    @Html.TextBox("nom_document_Extern", null, new { @class = " form-control input-sm", @onkeypress = "return IsNom_vista(this.value);", @onkeyup = "return Valida_back_vista(this.value);" })
                </div>
            </div>
            <div class="col-md-4" style="padding-top:30px;">
                <div class="form-group" style="margin-left: 0px; margin-right: 0px; margin-bottom: 0px;">
                    <label class="control-label"></label>
                    <button id="btnNuevaPersona" type="button" class="btn btn-primary btn-sm act_oficina">Nueva Persona</button>
                    <button id="btnNuevaOficina" type="button" class="btn btn-primary btn-sm act_oficina">Nueva Entidad</button>
                </div>
            </div>
        </div>
        <div class="act_oficina row">
            <div class="col-md-3">
                <div class="form-group" style="margin-left:0px; margin-right:0px;">
                    <label class="unica_direccion control-label">Razón social:</label>
                    <label class="varias_direcciones control-label">Razón social:</label>
                    <label class="varias_personas control-label">Razón social:</label>
                    @Html.TextBox("nombre_externo", null, new { @class = "form-control input-sm unica_direccion", @readonly = "readonly" })
                    @Html.DropDownList("cmb_nombre_externo", (IEnumerable<SelectListItem>)ViewBag.lst_oficinas, new { @class = "form-control input-sm varias_direcciones" })
                    @Html.DropDownList("cmb_persona_externo", (IEnumerable<SelectListItem>)ViewBag.lst_persona_ext, new { @class = "form-control input-sm varias_personas" })
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group" style="margin-left:0px; margin-right:0px;">
                    <label class="unica_direccion control-label">Dirección:</label>
                    <label class="varias_direcciones control-label">Dirección:</label>
                    <label class="varias_personas control-label">Dirección:</label>
                    <label id="lbl_valida_direccion_combo" style="color: #B44D4D">  </label>
                    @Html.TextBox("direccion_externo", null, new { @class = "form-control input-sm unica_direccion", @readonly = "readonly" })
                    @Html.DropDownList("cmb_direccion", (IEnumerable<SelectListItem>)ViewBag.lst_direcciones, new { @class = "form-control input-sm varias_direcciones" })
                    @Html.TextBox("direccion_per_externo", null, new { @class = "form-control input-sm varias_personas", @readonly = "readonly" })
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <div class="form-group" style="margin-left:0px; margin-right:0px;">
                    <label class="control-label">Asunto:</label>
                    @Html.ValidationMessageFor(m => m.asunto)
                    @Html.TextAreaFor(m => m.asunto, new { @class = "form-control input-sm", @rows = "4", @maxlength = "500" })
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group" style="margin-left:0px; margin-right:0px;">
                    <label class="control-label">Referencia:</label>
                    @Html.ValidationMessageFor(m => m.referencia)
                    @Html.TextAreaFor(m => m.referencia, new { @class = "form-control input-sm", @rows = "4", @maxlength = "1500" })
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group" style="margin-left:0px; margin-right:0px;">
                    <label class="control-label">Anexos:</label>
                    @Html.ValidationMessageFor(m => m.anexos)
                    @Html.TextAreaFor(m => m.anexos, new { @class = "form-control input-sm", @rows = "4", @maxlength = "1500" })
                </div>
            </div>    
        </div>

        <ol class="breadcrumb" style="margin-bottom:0px;">
            <li class="active">Destino de la Hoja de Trámite</li>
        </ol>
        <hr>
        <div class="form-group">



            <div class="col-md-4">
                <label class="control-label" for="cmbsede_destino">Sede:</label>
                @Html.DropDownList("cmbsede_destino", (IEnumerable<SelectListItem>)ViewBag.lstsede_destino, new { @class = "form-control input-sm" })
            </div>

            <div class="col-md-4">
                <label class="control-label" for="cmdoficina_destino">Oficina:</label>
                @Html.DropDownList("cmdoficina_destino", (IEnumerable<SelectListItem>)ViewBag.lstOficina_destino, new { @class = "form-control input-sm" })
            </div>
            <div class="col-md-4">
                <label class="control-label" for="cmbencargado">Encargado:</label>
                @Html.DropDownList("cmbencargado", (IEnumerable<SelectListItem>)ViewBag.lstpersonal_oficina, new { @class = "form-control input-sm" })
                <label id="lbl_valida_encarg_dest" style="color: #B44D4D">  </label>
            </div>

            <div class="col-md-4">
                <label id="idlblCheckDestinoPrincipal" hidden="hidden"  class="control-label" for="CheckBox_DestinoPrincipal">Identifica Destino Principal:</label>
                <input id="idCheckDestinoPrincipal" type="checkbox" hidden="hidden" />
            </div>
            <div class="col-md-12">
                <label class="control-label" for="txt_observacion">Observación:</label>
                <textarea class="form-control input-sm" id="txt_observacion" name="txt_observacion" maxlength="500"></textarea>
            </div>
            <div class="col-md-3">
                <div class="checkbox">
                    @Html.CheckBox("ind_01")
                    @Html.Label("1- ACCIÓN NECESARIA")
                </div>
                <div class="checkbox">
                    @Html.CheckBox("ind_02")
                    @Html.Label("2- CONOCIMIENTO")
                </div>
                <div class="checkbox">
                    @Html.CheckBox("ind_03")
                    @Html.Label("3- ATENDER")
                </div>
            </div>
            <div class="col-md-3">
                <div class="checkbox">
                    @Html.CheckBox("ind_04")
                    @Html.Label("4- CONVERSAR")
                </div>
                <div class="checkbox">
                    @Html.CheckBox("ind_05")
                    @Html.Label("5- INFORMAR")
                </div>
                <div class="checkbox">
                    @Html.CheckBox("ind_06")
                    @Html.Label("6- COORDINAR CON")
                </div>
            </div>
            <div class="col-md-3">
                <div class="checkbox">
                    @Html.CheckBox("ind_07")
                    @Html.Label("7- RESPONDER")
                </div>
                <div class="checkbox">
                    @Html.CheckBox("ind_08")
                    @Html.Label("8- ARCHIVAR")
                </div>
                <div class="checkbox">
                    @Html.CheckBox("ind_09")
                    @Html.Label("9- REVISAR")
                </div>
            </div>
            <div class="col-md-3">
                <div class="checkbox">
                    @Html.CheckBox("ind_10")
                    @Html.Label("10- DEVOLVER")
                </div>
                <div class="checkbox">
                    @Html.CheckBox("ind_11")
                    @Html.Label("11- TRAMITE")
                </div>
            </div>
            <br>
            <div class="col-md-12">
                <div style="margin-top:15px;">
                    <button type="button" class="btn btn-primary btn-sm" id="btnAceptar">
                        Agregar Destino
                    </button>
                </div>
                <div id="grid" style="margin-right: 10px;padding-right: 15px; margin-top:10px;">
                    <table class="table table-striped table-hover table-condensed tabla small" data-swhgajax="true" data-swhgcontainer="grid" data-swhgcallback="" id="tblDestinoDetalle">
                        <thead>
                            <tr class="cabecera">
                                <th scope="col" class="hidden">idOficina</th>
                                <th scope="col" class="visible-lg visible-md">Sede</th>
                                <th scope="col">Oficina</th>
                                <th scope="col" class="visible-lg">Observación</th>
                                <th scope="col" class="hidden">ind_01</th>
                                <th scope="col" class="hidden">ind_02</th>
                                <th scope="col" class="hidden">ind_03</th>
                                <th scope="col" class="hidden">ind_04</th>
                                <th scope="col" class="hidden">ind_05</th>
                                <th scope="col" class="hidden">ind_06</th>
                                <th scope="col" class="hidden">ind_07</th>
                                <th scope="col" class="hidden">ind_08</th>
                                <th scope="col" class="hidden">ind_09</th>
                                <th scope="col" class="hidden">ind_10</th>
                                <th scope="col" class="hidden">dni</th>
                                <th scope="col">persona</th>
                                <th scope="col" class="hidden">ind_11</th>
                                <th scope="col">Acciones</th>
                                <th scope="col">Destino Principal</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

            </div>
        </div>
        <hr>
        <div class="form-group" style="text-align:right;">
            <div class="col-md-12">
                <input id="btnGrabar" type="submit" value="Guardar" class="btn btn-primary btn-sm" />
                <button type="button" class="btn btn-default btn-sm regresar">Cancelar</button>
            </div>
        </div>

        <div class="col-md-1">
            <div id="loaderImage" class="hidden"></div>
        </div>
    </div>
}

<div class="modal fade" id="mdlConformidad" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Mensaje</h4>
                <input type="text" id="txtId" class="hidden" />
            </div>
            <div class="modal-body">
                <span id="conformidad"></span>
                <br>
                <span id="conformidad_doc"></span>
                <p>Presione aceptar para continuar.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}

<script type="text/javascript">

   
    $('#cmbtipo_documento').change(function () {

        var cmbtipo_documento = $('#cmbtipo_documento').val();

        if ((cmbtipo_documento == 76) || (cmbtipo_documento == 161) || (cmbtipo_documento == 95) ) {

            document.getElementById('idlblCheckDestinoPrincipal').hidden = false;
            document.getElementById('idCheckDestinoPrincipal').hidden = false;

        } else {
            document.getElementById('idlblCheckDestinoPrincipal').hidden = true;
            document.getElementById('idCheckDestinoPrincipal').hidden = true;
        }
    });




    function valida_enter(dato)
    {
        if (window.event.keyCode == 13) {
            window.event.returnValue = false;
        }
        else
        {
            window.event.returnValue = true;
        }
    }

    function IsNumeric(dato) {
        var valor = dato.indexOf(".");
        if ((window.event.keyCode > 47 && window.event.keyCode < 58)) {
            window.event.returnValue = true;
        }
        else {
            window.event.returnValue = false;
        }
    }

    function Valida_back_vista(dato) {
        if (window.event.keyCode == 8) {
            if ($("#num_documento_externo").val().length < 20) {
                $("#nombre_externo").val("");
                $("#direccion_externo").val("");
                $("#direccion_per_externo").val("");
                $("#persona_externa_encontro").val("0");
                $('.unica_direccion').hide();
                $('.varias_direcciones').hide();
                $('.varias_personas').hide();
            }
        }
    }

    function IsNom_vista(dato) {
        var valor = dato.indexOf(".");
        var evento = window.event || dato;

        if ($("#nom_document_Extern").val().trim() != "") {
            $("#nombre_externo").val("");
            $("#direccion_externo").val("");
            $("#direccion_per_externo").val("");
            $("#persona_externa_encontro").val("0");
            $('.unica_direccion').hide();
            $('.varias_direcciones').hide();
            $('.varias_personas').hide();
            if ($("#cmb_tip_doc_iden").val() == 0) {
                recupera_RUC_NOM(($("#nom_document_Extern").val() + String.fromCharCode(evento.charCode)).trim());
            }
            else {
                recupera_DNI_NOM(($("#nom_document_Extern").val() + String.fromCharCode(evento.charCode)).trim());
            }
        }
    }

    function IsNumeric_vista(dato) {
        var valor = dato.indexOf(".");
        var evento = window.event || dato;
        if ((window.event.keyCode > 47 && window.event.keyCode < 58)) {

            if ($("#nom_document_Extern").val().trim() == "") {

                if ($("#num_documento_externo").val().length < 7) {
                    $("#nombre_externo").val("");
                    $("#nom_document_Extern").val("");
                    $("#direccion_externo").val("");
                    $("#direccion_per_externo").val("");
                    $("#persona_externa_encontro").val("0");
                    $('.unica_direccion').hide();
                    $('.varias_direcciones').hide();
                    $('.varias_personas').hide();
                }
                else {
                    if ($("#cmb_tip_doc_iden").val() == 0) {
                        recupera_RUC(($("#num_documento_externo").val() + String.fromCharCode(evento.charCode)).trim());
                    }
                    else {
                        recupera_DNI_CE(($("#num_documento_externo").val() + String.fromCharCode(evento.charCode)).trim());
                    }
                }
            }
            window.event.returnValue = true;
        }
        else {
            window.event.returnValue = false;
        }
    }

    function recupera_DNI_CE(texto) {
        $.ajax({
            cache: false,
            type: "GET",
            url: "@(Url.RouteUrl("Consultar_DNI_vista"))",
            data: { "DNI": texto },

            success: function (data) {
                $.each(data, function (id, option) {
                    if (option.Value != "NO") {
                        $("#persona_externa_encontro").val("1");
                        $("#nombre_externo").val(option.Text);
                        recupera_DNI_CE_DIRECCION(texto);
                        $('.unica_direccion').show();
                    }
                    else {
                        $("#nombre_externo").val("");
                        $("#direccion_externo").val("");
                        $("#direccion_per_externo").val("");
                        $("#persona_externa_encontro").val("0");
                        $('.unica_direccion').hide();
                        $('.varias_direcciones').hide();
                        $('.varias_personas').hide();
                    }
                });
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert('Failed to retrieve states.');
            }
        });
    }

    function recupera_DNI_CE_DIRECCION(texto) {
        $.ajax({
            cache: false,
            type: "GET",
            url: "@(Url.RouteUrl("Consultar_DNI_DIRECCION_vista"))",
            data: { "DNI": texto },

            success: function (data) {
                $.each(data, function (id, option) {
                    $("#direccion_externo").val(option.Text);
                });
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert('Failed to retrieve states.');
            }
        });
    }

    function recupera_DNI_CE_DIRECCION_personas(texto) {
        $.ajax({
            cache: false,
            type: "GET",
            url: "@(Url.RouteUrl("Consultar_DNI_DIRECCION_vista"))",
            data: {
                "DNI": texto
            },

            success: function (data) {
                $.each(data, function (id, option) {
                    $("#direccion_per_externo").val(option.Text);
                });
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert('Failed to retrieve states.');
            }
        });
    }

    function recupera_DNI_NOM(texto) {
        var entra = 0;
        $.ajax({
            cache: false,
            type: "GET",
            url: "@(Url.RouteUrl("recupera_DNI_NOM_vista"))",
            data: {
                "NOM": texto,
                "TIPO": $("#cmb_tip_doc_iden").val()
            },
            success: function (data) {
                $("#cmb_persona_externo").html('');
                $.each(data, function (id, option) {
                    if (option.Value != "NO") {
                        $("#cmb_persona_externo").append($('<option></option>').val(option.Value).html(option.Text));
                        if (entra == 0) {
                            recupera_DNI_CE_DIRECCION_personas(option.Value);
                            entra = 1;
                            $("#persona_externa_encontro").val("1");
                            $('.varias_personas').show();
                        }

                    }
                    else {
                        $("#persona_externa_encontro").val("0");
                        $('.varias_personas').hide();
                    }
                });
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert('Failed to retrieve states.');
            }
        });
    }

    function recupera_RUC_NOM(texto) {
        var entra = 0;
        $.ajax({
            cache: false,
            type: "GET",
            url: "@(Url.RouteUrl("recupera_RUC_NOM_vista"))",
            data: { "NOM": texto },
            success: function (data) {
                $("#cmb_nombre_externo").html('');
                $.each(data, function (id, option) {
                    if (option.Value != "NO") {
                        $("#cmb_nombre_externo").append($('<option></option>').val(option.Value).html(option.Text));
                        if (entra == 0) {
                            recupera_RUC_DIRECCION(option.Value);
                            entra = 1;
                            $("#persona_externa_encontro").val("1");
                            $('.varias_direcciones').show();
                        }

                    }
                    else {
                        $("#persona_externa_encontro").val("0");
                        $('.varias_direcciones').hide();
                    }
                });
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert('Failed to retrieve states.');
            }
        });
    }

    function recupera_RUC(texto) {
        var entra = 0;
        $.ajax({
            cache: false,
            type: "GET",
            url: "@(Url.RouteUrl("recupera_RUC_vista"))",
            data: { "RUC": texto },
            success: function (data) {
                $("#cmb_nombre_externo").html('');
                $.each(data, function (id, option) {
                    if (option.Value != "NO") {
                        $("#cmb_nombre_externo").append($('<option></option>').val(option.Value).html(option.Text));
                        if (entra == 0) {
                            recupera_RUC_DIRECCION(option.Value);
                            entra = 1;
                            $("#persona_externa_encontro").val("1");
                            $('.varias_direcciones').show();
                        }
                    }
                    else {
                        $("#persona_externa_encontro").val("0");
                        $('.varias_direcciones').hide();
                    }
                });
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert('Failed to retrieve states.');
            }
        });
    }

    function recupera_RUC_DIRECCION(texto) {
        var ddldireccion = $("#cmb_direccion");
        var entra = 0;
        $.ajax({
            cache: false,
            type: "GET",
            url: "@(Url.RouteUrl("recupera_RUC_DIRECCION_vista"))",
            data: { "ID_OFICINA": texto },

            success: function (data) {

                ddldireccion.html('');
                $.each(data, function (id, option) {
                    ddldireccion.append($('<option></option>').val(option.Value).html(option.Text));
                });
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert('Failed to retrieve states.');
            }
        });
    }

    $(document).ready(function () {

        if ($("#ver_num_doc").val() == 0) {
            $('.autonume').hide();
            $("#numero_documento").val(1);
            $("#nom_doc").val("xxx");
        }

        document.getElementById('lbl_carga_data_ht').innerHTML = "";
        $("#txt_pedido_siga").val("");
        $("#anexos").click(function () {
            $("#anexos").attr("rows", 8);
        });

        $("#anexos").focusout(function () {
            $("#anexos").attr("rows", 4);
        });

        $(document).on("click", ".relacionar", function () {
            $("#HT_PADRE").val($(this).prev().prev().prev().html());
            $('#mdlhoja_tramite').modal('hide');
        });
        
        $(document).on("click", ".buscar_ht_padre", function () {

            $("#bus_tbl_ht").html('');

            document.getElementById('lbl_carga_data_ht').innerHTML = "Cargando...";
            jQuery("#bus_tbl_ht").append('<table id="tbl_ht" class="table table-striped table-hover table-condensed tabla small" cellspacing="0"> <thead> <tr class="cabecera"> '+
                '<th>HT</th> <th>ASUNTO</th> <th>FECHA DE EMISION</th> <th>ACCIONES</th> </tr> </thead> <tbody></tbody> </table>');
            $.ajax({
                cache: false,
                type: "GET",
                url: "@(Url.RouteUrl("llenar_HT_Padre"))",
                data: { "buscador": $("#txt_Buscar_Padre").val() },
                success: function (data) {
                    document.getElementById('lbl_carga_data_ht').innerHTML = "";

                    $.each(data, function (id, option) {
                        var nuevoTD = '<tr>';
                        nuevoTD += '<td style=" text-align:center;">' + option.hoja_tramite + '</td>';
                        nuevoTD += '<td >' + option.asunto + '</td>';
                        nuevoTD += '<td style="width:100px; text-align:center;">' + option.fecha_emision_text + '</td>';
                        nuevoTD += '<td style="text-align:center;" class="relacionar"> <ul class="list-inline" style="margin-bottom:0"> <li> <a class="relacionar" href="#" id="3" title="relacionar"> <i class="glyphicon glyphicon-ok"></i> </a> </li> </ul> </td>';
                        nuevoTD += '</tr>';
                        jQuery("#tbl_ht").append(nuevoTD);
                    });

                    $("#tbl_ht").DataTable({
                        "lengthChange": false,
                        "searching": false,
                        "info": false,
                        "language": {
                            "paginate": {
                                "previous": "Anterior",
                                "next": "Siguiente"
                            }
                        }
                    });

                    $("#tbl_ht thead tr th").eq(0).css({ "width": 25 });
                    $("#tbl_ht thead tr th").eq(1).css({ "width": 170 });
                    $("#tbl_ht thead tr th").eq(2).css({ "width": 80 });
                    $("#tbl_ht thead tr th").eq(3).css({ "width": 25 });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Failed to retrieve states.');
                }
            });
        });

        $("#persona_externa_encontro").val("0");

        document.getElementById('lbl_valida_ext').innerHTML = "";
        document.getElementById('lbl_valida_folios').innerHTML = "";
        document.getElementById('lbl_valida_nom_doc').innerHTML = "";

        $('.unica_direccion').hide();
        $('.varias_direcciones').hide();
        $('.varias_personas').hide();
        $('.act_oficina').hide();


        $(document).on("click", ".regresar", function () {
            window.location = '@Url.Action("Por_Recibir_Ht", "HojaTramite")';
        });

        $(document).on("click", ".limpiar", function () {
            $("#HT_PADRE").val("");
        });

        $("#cmb_nombre_externo").change(function () {
            var selc_nombre = $(this).val();
            recupera_RUC_DIRECCION(selc_nombre);
        });

        $("#cmb_persona_externo").change(function () {
            var selc_nombre = $(this).val();
            recupera_DNI_CE_DIRECCION_personas(selc_nombre);
        });

        var i = 0;
        var m_par = 0;
        var usuario_string = $("#log_user").val();

        var usuario_id_perfil = usuario_string.split('|')[5].toString();

        for (i; i < usuario_id_perfil.toString().trim().split(',').length; i++) {
            if (usuario_id_perfil.toString().trim().split(',')[i].toString() == "9") {
                m_par = 1;
            }
        }

        /*
        if (m_par == 0) {
            $("#ac_externo").val("2");
        }
        else {
            $("#ac_externo").val("1");
            $("#Check_Externo").prop('checked', true);
            $('.act_oficina').show();
        }*/


        $('input').bind('copy paste', function (e) {
            e.preventDefault();
        });
        /*
                $('input[type="checkbox"]').change(function () {
                    var id = $(this).attr('id');
                    if (id == "Check_Externo") {
                        if ($("#ac_externo").val() == "2") {
                            $("#ac_externo").val("1");
                            $("#num_documento_externo").val("");
                            $("#nombre_externo").val("");
                            $("#id_oficina_externa").val("");
                            $("#id_tipo_per").val("");
                            document.getElementById('lbl_valida_ext').innerHTML = "";
                            $('.act_oficina').show();
                        }
                        else {
                            $("#persona_externa_encontro").val("0");
                            $("#ac_externo").val("2");
                            $("#num_documento_externo").val("");
                            $("#nombre_externo").val("");
                            $("#id_oficina_externa").val("");
                            $("#id_tipo_per").val("");
                            $('.act_oficina').hide();
                            $('.direccion').hide();
                            $('.unica_direccion').hide();
                            $('.varias_direcciones').hide();
                        }
                    }

                });
        */

        var f = new Date();
        var fechaActual = (f.getDate() < 10 ? "0" + f.getDate() : f.getDate()) + "/" + ((f.getMonth() + 1) < 10 ? "0" + (f.getMonth() + 1) : (f.getMonth() + 1)) + "/" + f.getFullYear();

        $(document).on("click", ".quitar", function () {
            var parent = $(this).parents().get(0);
            $(parent).remove();
        });

        $("#cmbsede_destino").change(function () {
            var Selectsede = $(this).val();
            var ddloficina = $("#cmdoficina_destino");
            var ddlencargado = $("#cmbencargado");
            var prim = 0;
            $.ajax({
                cache: false,
                type: "GET",
                url: "@(Url.RouteUrl("Llenar_oficina_sede_externo"))",
                data: { "id_sede": Selectsede },
                success: function (data) {

                    ddloficina.html('');
                    $.each(data, function (id, option) {
                        ddloficina.append($('<option></option>').val(option.Value).html(option.Text));
                    });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Failed to retrieve states.');
                }
            });

            $.ajax({
                cache: false,
                type: "GET",
                url: "@(Url.RouteUrl("Llenar_personal"))",
                data: { "id_oficina_destino": prim },
                success: function (data) {
                    ddlencargado.html('');
                    $.each(data, function (id, option) {
                        ddlencargado.append($('<option></option>').val(option.Value).html(option.Text));
                    });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Failed to retrieve states.');
                }
            });

        });

        $("#cmdoficina_destino").change(function () {
            var SelectOficina = $(this).val();
            var ddlencargado = $("#cmbencargado");
            $.ajax({
                cache: false,
                type: "GET",
                url: "@(Url.RouteUrl("Llenar_personal"))",
                data: { "id_oficina_destino": SelectOficina },
                success: function (data) {
                    ddlencargado.html('');
                    $.each(data, function (id, option) {
                        ddlencargado.append($('<option></option>').val(option.Value).html(option.Text));
                    });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Failed to retrieve states.');
                }
            });
        });



        $("#cmb_tip_doc_iden").change(function () {
            $("#persona_externa_encontro").val("0");
            $("#num_documento_externo").val("");
            $("#nombre_externo").val("");
            $("#nom_document_Extern").val("");
            $("#id_oficina_externa").val("");
            $("#id_tipo_per").val("");
            $('.act_oficina').hide();
            $('.direccion').hide();
            $('.unica_direccion').hide();
            $('.varias_direcciones').hide();
            $('.varias_personas').hide();
            $('.n_act_oficina').show();
            $("#ac_externo").val("1");
            document.getElementById('lbl_valida_ext').innerHTML = "";
            $('.act_oficina').show();
            $('.n_act_oficina').hide();
        });

        $("#cmbtipo_documento").change(function () {
            var Selectpdoc = $(this).val();
            $.ajax({
                cache: false,
                type: "GET",
                url: "@(Url.RouteUrl("consultar_tipo_expediente"))",
                data: { "id": Selectpdoc },
                success: function (data) {
                    $.each(data, function (id, option) {
                        if (option.Value.toString().trim() == "E") {
                            $("#ac_externo").val("1");
                            $("#num_documento_externo").val("");
                            $("#nombre_externo").val("");
                            $("#nom_document_Extern").val("");
                            $("#id_oficina_externa").val("");
                            $("#id_tipo_per").val("");
                            document.getElementById('lbl_valida_ext').innerHTML = "";
                            $('.act_oficina').show();
                            $('.n_act_oficina').hide();
                            if ($("#ver_num_doc").val() == 0) {
                                $('.autonume').show();
                                $("#numero_documento").val("");
                                $("#nom_doc").val("");
                            }                            
                        }
                        else {
                            $("#persona_externa_encontro").val("0");
                            $("#ac_externo").val("2");
                            $("#num_documento_externo").val("");
                            $("#nombre_externo").val("");
                            $("#id_oficina_externa").val("");
                            $("#nom_document_Extern").val("");
                            $("#id_tipo_per").val("");
                            $('.act_oficina').hide();
                            $('.direccion').hide();
                            $('.unica_direccion').hide();
                            $('.varias_direcciones').hide();
                            $('.varias_personas').hide();
                            $('.n_act_oficina').show();
                            if ($("#ver_num_doc").val() == 0) {
                                $('.autonume').hide();
                                $("#numero_documento").val(1);
                                $("#nom_doc").val("xxx");
                                if (Selectpdoc == 149 || Selectpdoc == 150) {
                                    $('.autonume').show();
                                    $("#numero_documento").val("");
                                    $("#nom_doc").val("");
                                }
                            }
                        }
                    });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Failed to retrieve states.');
                }
            });
        });

        $('#modal_crear_Empresa').on('show.bs.modal', function (e) {
            $("#v_ruc").val("");
            $("#v_nombre").val("");
            $("#v_siglas").val("");
            document.getElementById('lbl_valida_ruc').innerHTML = "";
            document.getElementById('lbl_valida_nombre').innerHTML = "";
        })

        $('#btnNuevaPersona').click(function () {

            $('#bntConfirmar_pagina').removeAttr("disabled", "disabled");
            $("#pagina_direccion").val("nueva_persona");
            document.getElementById('lbl_valida_confirma_pagina').innerHTML = "Esta seguro de salir del registro de HT, para registrar una nueva persona?";
            $('#mdlConfirmar_pagina').modal();
        });
        
        $('#bntConfirmar_pagina').click(function () {
            if ($("#pagina_direccion").val() == "nueva_persona") {
                var url = "/Hojatramite/Nueva_Natural/";
                window.location.href = url;
            }
            else
            {
                if ($("#pagina_direccion").val() == "nueva_oficina") {
                    var url = "/Oficina/Nueva_Oficina/";
                    window.location.href = url;
                }
            }
        });

        $('#btnNuevaOficina').click(function () {
            $('#bntConfirmar_pagina').removeAttr("disabled", "disabled");
            $("#pagina_direccion").val("nueva_oficina");
            document.getElementById('lbl_valida_confirma_pagina').innerHTML = "Esta seguro de salir del registro de HT, para registrar una nueva Entidad?";
            $('#mdlConfirmar_pagina').modal();
        });

        $('#btnAceptar').click(function () {
            var ckeck = document.getElementById('idCheckDestinoPrincipal').check;
            document.getElementById('lbl_valida_encarg_dest').innerHTML = "";

            if ($("#cmbencargado").val() == "") {
                document.getElementById('lbl_valida_encarg_dest').innerHTML = "Seleccionar Personal destino";
                return;
            }

            var v_ind_01 = $('#ind_01').prop('checked');
            var v_ind_02 = $('#ind_02').prop('checked');
            var v_ind_03 = $('#ind_03').prop('checked');
            var v_ind_04 = $('#ind_04').prop('checked');
            var v_ind_05 = $('#ind_05').prop('checked');
            var v_ind_06 = $('#ind_06').prop('checked');
            var v_ind_07 = $('#ind_07').prop('checked');
            var v_ind_08 = $('#ind_08').prop('checked');
            var v_ind_09 = $('#ind_09').prop('checked');
            var v_ind_10 = $('#ind_10').prop('checked');
            var v_ind_11 = $('#ind_11').prop('checked');


            var nuevoTD = '<tr>';
            nuevoTD += '<td class = "hidden">' + $("#cmdoficina_destino").val() + '</td>';
            nuevoTD += '<td class="visible-lg visible-md">' + $("#cmbsede_destino option:selected").text() + '</td>';
            nuevoTD += '<td>' + $("#cmdoficina_destino option:selected").text() + '</td>';
            nuevoTD += '<td class="visible-lg">' + $('#txt_observacion').val() + '</td>';
            nuevoTD += '<td class = "hidden">' + v_ind_01 + '</td>';
            nuevoTD += '<td class = "hidden">' + v_ind_02 + '</td>';
            nuevoTD += '<td class = "hidden">' + v_ind_03 + '</td>';
            nuevoTD += '<td class = "hidden">' + v_ind_04 + '</td>';
            nuevoTD += '<td class = "hidden">' + v_ind_05 + '</td>';
            nuevoTD += '<td class = "hidden">' + v_ind_06 + '</td>';
            nuevoTD += '<td class = "hidden">' + v_ind_07 + '</td>';
            nuevoTD += '<td class = "hidden">' + v_ind_08 + '</td>';
            nuevoTD += '<td class = "hidden">' + v_ind_09 + '</td>';
            nuevoTD += '<td class = "hidden">' + v_ind_10 + '</td>';
            nuevoTD += '<td class = "hidden">' + $("#cmbencargado").val() + '</td>';
            nuevoTD += '<td>' + $("#cmbencargado option:selected").text() + '</td>';
            nuevoTD += '<td class = "hidden">' + v_ind_11 + '</td>';
            nuevoTD += '<td class="quitar"><ul class="list-inline" style="margin-bottom:0"><li><a class="quitar" href="#" id="5" title="Quitar"><i class="red glyphicon glyphicon-trash"></i></a></li></ul></td>'
            
            if (document.getElementById('idCheckDestinoPrincipal').checked == true) {
                nuevoTD += '<td id="1" class="ok"><ul id="1" class="list-inline" style="margin-bottom:0"><li><a class="ok" href="#" id="1" title="Destino Principal"><i class="gree glyphicon glyphicon-ok"></i></a></li></ul></td>'
            }
            else {
                 nuevoTD += '<td id="0" class="ok"><ul id="0" class="list-inline" style="margin-bottom:0"><li><a class="ok" href="#" id="0" title="Destino Secundario"><i class="red glyphicon glyphicon-ok"></i></a></li></ul></td>'
            }
            nuevoTD += '</tr>';

            jQuery("#tblDestinoDetalle").append(nuevoTD);

            $("#observacion").val("");
        });

        $('#mdloficina_destino').on('show.bs.modal', function (e) {
            $("#txt_observacion").val("");
            document.getElementById('lbl_valida_encarg_dest').innerHTML = "";
            $("#cmbencargado").val("");
            $("#cmdoficina_destino").val("0");
            $("#cmbsede_destino").val("0");
            $("#cmbsede_destino").focus();
            $('#ind_01').attr('checked', false);
            $('#ind_02').attr('checked', false);
            $('#ind_03').attr('checked', false);
            $('#ind_04').attr('checked', false);
            $('#ind_05').attr('checked', false);
            $('#ind_06').attr('checked', false);
            $('#ind_07').attr('checked', false);
            $('#ind_08').attr('checked', false);
            $('#ind_09').attr('checked', false);
            $('#ind_10').attr('checked', false);
            $('#ind_11').attr('checked', false);

            var form = $("#formdestino");
            validator = form.validate();

            validator.resetForm();
            form.find(".error").removeClass("error");
        })

        $('#mdlConformidad').on('hide.bs.modal', function (e) {
            setTimeout(function () {
                var url = "/Hojatramite/Imprimir_Nuevo/" + $("#txtId").val();
                window.location.href = url;
            }, 300);
        })

        $('#nuevoForm').submit(function (e) {

            $('#btnGrabar').attr("disabled", "disabled");

            document.getElementById('lbl_valida_ext').innerHTML = "";
            document.getElementById('lbl_valida_folios').innerHTML = "";
            document.getElementById('lbl_valida_nom_doc').innerHTML = "";
            document.getElementById('lbl_valida_pedido_siga').innerHTML = "";
            document.getElementById('lbl_valida_direccion_combo').innerHTML = "";

            var per_crea = "";
            var entra = 0;
            var var_xoficina = 0;
            var var_xpersona_num_documento = null;
            var var_nom_externo = null;
            var var_xtipo_per = 0;
            if ($("#ac_externo").val() == "1") {

                if ($("#persona_externa_encontro").val() == "0") {
                    document.getElementById('lbl_valida_ext').innerHTML = "Seleccionar Persona Externa";
                    entra = 1;
                }
                else {
                    if ($("#cmb_tip_doc_iden").val() == "0") {
                        if ($("#cmb_direccion").val() == "0") {
                            document.getElementById('lbl_valida_direccion_combo').innerHTML = "Seleccionar dirección";
                            entra = 1;
                        }
                        else
                        {
                            var_xoficina = $("#cmb_direccion").val();
                            var_nom_externo = $('select[name="cmb_nombre_externo"] option:selected').text();
                        }
                    }
                    else {
                        if ($("#nombre_externo").val() == "") {
                            var_xpersona_num_documento = $("#cmb_persona_externo").val();
                            var_xtipo_per = parseInt($("#cmb_tip_doc_iden").val());
                            var_nom_externo = $('select[name="cmb_persona_externo"] option:selected').text();
                        }
                        else {
                            var_xpersona_num_documento = $("#num_documento_externo").val();
                            var_xtipo_per = parseInt($("#cmb_tip_doc_iden").val());
                            var_nom_externo = $("#num_documento_externo").val() + " - " + $("#nombre_externo").val();
                        }
                    }
                }
            }
            else {
                per_crea = $('#cmbpersona_crea').val();
                var_nom_externo = null;
            }

            if ($('#folios').val() == 0 || $('#folios').val().trim() == "") //si no ingresa cantidad de folios
            {
                document.getElementById('lbl_valida_folios').innerHTML = "Ingresar folios";
                entra = 1;
            }
            if ($('#nom_doc').val().trim() == "") {
                document.getElementById('lbl_valida_nom_doc').innerHTML = "Ingresar Documento";
                entra = 1;
            }

            if ($('#txt_pedido_siga').val().trim() != "" || $("#cmb_tip_pedido_siga").val() != "" || $("#cmb_tip_anno_siga").val() != "") {
                if($('#txt_pedido_siga').val().trim() == "" || $("#cmb_tip_pedido_siga").val() == "" || $("#cmb_tip_anno_siga").val() == "") {
                    document.getElementById('lbl_valida_pedido_siga').innerHTML = "Seleccionar Año, Tipo Pedido y digitar el número SIGA";
                    entra = 1;
                }
            }

            if (!$("#nuevoForm").valid())//Si no pasa la validacion no entra
            {
                $('#btnGrabar').removeAttr("disabled", "disabled");
                return;
            }
            e.preventDefault();

            if (entra == 1) {
                $('#btnGrabar').removeAttr("disabled", "disabled");
                return
            }

            if ($('#tblDestinoDetalle >tbody >tr').length == 0)//Valida que haya elementos en la tabla
            {
                $('#myModal').modal();
                $('#btnGrabar').removeAttr("disabled", "disabled");
                return;
            }

            if ($("#var_guardar").val() == "1") {
                $('#btnGrabar').removeAttr("disabled", "disabled");
                return;
            }
            else {

                //Llena un arreglo de objetos que son pasados a data
                var band = false;
                var lstDetalle = new Array();
                $('#tblDestinoDetalle tr').each(function () {
                    if (band) {
                        var item = {
                            "id_det_documento": 0,
                            "id_documento": 0,
                            "oficina_destino": $(this).find("td").eq(0).html(),
                            "observacion": $(this).find("td").eq(3).html(),
                            "ind_01": $(this).find("td").eq(4).html(),
                            "ind_02": $(this).find("td").eq(5).html(),
                            "ind_03": $(this).find("td").eq(6).html(),
                            "ind_04": $(this).find("td").eq(7).html(),
                            "ind_05": $(this).find("td").eq(8).html(),
                            "ind_06": $(this).find("td").eq(9).html(),
                            "ind_07": $(this).find("td").eq(10).html(),
                            "ind_08": $(this).find("td").eq(11).html(),
                            "ind_09": $(this).find("td").eq(12).html(),
                            "ind_10": $(this).find("td").eq(13).html(),
                            "persona_num_documento": $(this).find("td").eq(14).html(),
                            "ind_11": $(this).find("td").eq(16).html(),
                            "flag_destino_principal": $(this).find("td").eq(4).html()
                        };
                        lstDetalle.push(item);
                        console.log(lstDetalle);
                    }
                    band = true;
                });

                var HT_DAD = "";
                if ($("#HT_PADRE").val() != null || $("#HT_PADRE").val() != "") {
                    HT_DAD = $("#HT_PADRE").val();
                }

                var f = new Date();
                var fechaActual = (f.getDate() < 10 ? "0" + f.getDate() : f.getDate()) + "/" + ((f.getMonth() + 1) < 10 ? "0" + (f.getMonth() + 1) : (f.getMonth() + 1)) + "/" + f.getFullYear();
                var data = {//Objeto que se envia al controlador
                    "numero": "",
                    "ID_TUPA": $("#cmbtupa").val(),
                    "pedido_siga": $("#txt_pedido_siga").val(),
                    "id_tipo_pedido_siga": $("#cmb_tip_pedido_siga").val(),
                    "anno_siga": $("#cmb_tip_anno_siga").val(),
                    "id_tipo_tramite": $("#ac_externo").val(),
                    "id_oficina": var_xoficina,
                    "id_tipo_per": var_xtipo_per,
                    "nom_doc": $("#nom_doc").val(),
                    "id_documento": 0,
                    "id_tipo_documento": $("#cmbtipo_documento").val(),
                    "numero_documento": $("#numero_documento").val(),
                    "persona_num_documento": var_xpersona_num_documento,
                    "anexos": $("#anexos").val(),
                    "folios": $("#folios").val(),
                    "asunto": $("#asunto").val(),
                    "documento_detalle": lstDetalle,
                    "id_expediente": 1,
                    "nombre_expediente": "",
                    "tipo_expediente": 11,
                    "persona_crea": per_crea,
                    "referencia": $("#referencia").val(),
                    "HT_PADRE": HT_DAD,
                    "nom_externo": var_nom_externo,
                };

                $("#var_guardar").val("1");

                $.ajax({
                    url: this.action,
                    type: this.method,
                    data: JSON.stringify(data), // Datos a enviar
                    processData: false,
                    contentType: 'application/json', // Tipo de datos que envío
                    beforeSend: function () {
                        $('#loaderImage').removeClass("hidden").addClass("show");
                        $('#btnGrabar').attr("disabled", "disabled");
                    },
                    complete: function () {
                        $('#loaderImage').removeClass("show").addClass("hidden");
                    },
                    success: function (result) {
                        $('.field-validation-error').each(function () {
                            $(this).removeClass("field-validation-error").addClass("field-validation-valid");
                            $(this).html('');
                        });
                        $("#conformidad").html(result.toString().split(':')[0].toString() + " : " + result.toString().split(':')[1].toString());
                        $("#txtId").val(result.toString().split(':')[2].toString());
                        var new_ht = result.toString().split(':')[1].toString();
                        var url_scan = "/HojaTramite/Adjuntar_HT/" + new_ht;
                        window.location.href = url_scan;
                        //$('#mdlConformidad').modal();
                    },
                    error: function (result) {
                        if (result.status == 500) {
                            $("#mensajes").html(result.responseText).hide();
                            $("html, body").animate({ scrollTop: 0 }, '500', 'swing', function () {
                                $("#mensajes").slideDown(500, function () { });
                            });
                        }
                        else if (result.status == 400) {
                            $('.field-validation-error').each(function () {
                                $(this).removeClass("field-validation-error").addClass("field-validation-valid");
                                $(this).html('');
                            });
                            $.each(result.responseJSON.errors, function (key, value) {
                                if (value != null) {
                                    var container = $('span[data-valmsg-for="' + key + '"]');
                                    container.removeClass("field-validation-valid").addClass("field-validation-error");
                                    container.html(value);
                                }
                            });
                            $("#mensajes").html(result.responseJSON.summary).hide();
                            if (result.responseJSON.summary != "") {
                                $("html, body").animate({ scrollTop: 0 }, '500', 'swing', function () {
                                    $("#mensajes").slideDown(500, function () { });
                                });
                            }
                        }
                    }
                });
            }

        });

    });
</script>
